# hw definition for ADA-F405

# MCU class and specific type
MCU STM32F4xx STM32F405xx

# bootloader starts firmware at 64k
FLASH_RESERVE_START_KB 64
FLASH_SIZE_KB 1024

# store parameters 
STORAGE_FLASH_PAGE 1
define HAL_STORAGE_SIZE 15360

# board ID for firmware load
APJ_BOARD_ID 1000

# USB setup
USB_STRING_MANUFACTURER "ArduPilot"
USB_STRING_PRODUCT "%BOARD%"

define STM32_ST_USE_TIMER 5
define CH_CFG_ST_RESOLUTION 32

# crystal frequency
OSCILLATOR_HZ 12000000

define HAL_USE_RTC TRUE

# SPI1
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1
PA4 MPU_CS CS

# SPI3 Flash
PB3 SPI3_SCK SPI3
PB4 SPI3_MISO SPI3
PB5 SPI3_MOSI SPI3
PA15 FLASH_CS CS

# MPU RDY 
PC4 MPU_DRDY INPUT
PC5 MPU_DRDY1 INPUT

# CAN bus
PB8 CAN1_RX CAN1
PB9 CAN1_TX CAN1

CAN_ORDER 1

# use DNA for node allocation

define CAN_APP_NODE_NAME "org.ardupilot.ADA-F405"

# debugger support
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# one I2C bus
PB6 I2C1_SCL I2C1
PB7 I2C1_SDA I2C1

define HAL_I2C_INTERNAL_MASK 0

I2C_ORDER I2C1


# order of UARTs
#          ---------------------------------------
#          | sr0 | sr1 | sr2 | sr3 | sr4 | sr5 | sr6
# AP Name                      GPS

SERIAL_ORDER OTG1 USART3 EMPTY USART6 

# USART3 
PB10 USART3_TX USART3 
PB11 USART3_RX USART3 

# USART6 for GPS
PC6 USART6_TX USART6 
PC7 USART6_RX USART6 

# USB
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

# USB setup
USB_STRING_MANUFACTURER "ArduPilot"
USB_STRING_PRODUCT "%BOARD%"

# SD Card pins  
PC8 SDIO_D0 SDIO
PC9 SDIO_D1 SDIO
PC10 SDIO_D2 SDIO
PC11 SDIO_D3 SDIO
PC12 SDIO_CK SDIO
PD2 SDIO_CMD SDIO
PB12 CARD_DETECT INPUT PULLUP

# enable DATAFLASH parameter storage
#SPIDEV dataflash SPI3 DEVID2 FLASH_CS MODE3 8*MHZ 8*MHZ
#define HAL_LOGGING_DATAFLASH_ENABLED 1

define HAL_OS_FATFS_IO 1
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"

SPIDEV icm42670 SPI1 DEVID1 MPU_CS MODE3 2*MHZ 8*MHZ
#IMU Invensensev3 SPI:icm42670 ROTATION_ROLL_180_YAW_90
IMU Invensensev3 SPI:icm42670 ROTATION_YAW_90
define HAL_DEFAULT_INS_FAST_SAMPLE 0

# COMPASS
COMPASS BMM150 I2C:0:0x10 false ROTATION_YAW_180

# DPS310
BARO DPS310 I2C:0:0x77

PA3 VSENSE1 ADC1 SCALE(1)
PC2 VSENSE2 ADC1 SCALE(1)
PC3 VSENSE3 ADC1 SCALE(1)

# PWM outputs
PB13 TIM1_CH1N TIM1 PWM(1) GPIO(50) 
PB14 TIM1_CH2N TIM1 PWM(2) GPIO(51) 
#PB15 TIM12_CH2 TIM12 PWM(3) GPIO(52) NODMA

define STM32_PWM_USE_ADVANCED TRUE

# RC input
PB15 TIM12_CH2 TIM12 RCININT PULLDOWN LOW


# WS2812 LED pin Neopixel
PC0 LED OUTPUT PWM(4) GPIO(52)

# safety LED, active HIGH
PC1 SAFE_LED OUTPUT HIGH
define SAFE_LED_ON 0

# --------------------- save flash ----------------------
define HAL_MINIMIZE_FEATURES 1

define AP_BATTMON_SMBUS_ENABLE 0
define HAL_PARACHUTE_ENABLED 0
define HAL_SPRAYER_ENABLED 0

define HAL_WITH_DSP FALSE
#define AP_GPS_UBLOX_ENABLED 1
#define AP_GPS_MAV_ENABLED 1

# setup a small defaults.parm
define AP_PARAM_MAX_EMBEDDED_PARAM 1024
